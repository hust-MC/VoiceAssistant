# è¯­éŸ³åŠ©æ‰‹åé¦ˆæœºåˆ¶è¯¦è§£

## ğŸ“‹ ç›®å½•
1. [åé¦ˆæœºåˆ¶æ€»è§ˆ](#åé¦ˆæœºåˆ¶æ€»è§ˆ)
2. [åé¦ˆæµç¨‹è®¾è®¡](#åé¦ˆæµç¨‹è®¾è®¡)
3. [TTSè¯­éŸ³åé¦ˆ](#ttsè¯­éŸ³åé¦ˆ)
4. [UIçŠ¶æ€åé¦ˆ](#uiçŠ¶æ€åé¦ˆ)
5. [è§†è§‰åŠ¨ç”»åé¦ˆ](#è§†è§‰åŠ¨ç”»åé¦ˆ)
6. [å®Œæ•´ç¤ºä¾‹ï¼šè°ƒèŠ‚ç©ºè°ƒ](#å®Œæ•´ç¤ºä¾‹è°ƒèŠ‚ç©ºè°ƒ)

---

## åé¦ˆæœºåˆ¶æ€»è§ˆ

### åé¦ˆçš„ä¸‰ä¸ªå±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç”¨æˆ·æ‰§è¡Œæ“ä½œ                      â”‚
â”‚       "æ¸©åº¦è°ƒé«˜"                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     1. TTSè¯­éŸ³åé¦ˆ                       â”‚
â”‚     "æ¸©åº¦å·²è°ƒé«˜è‡³25åº¦"                    â”‚
â”‚     ğŸ”Š è¯­éŸ³æ’­æŠ¥                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     2. UIçŠ¶æ€åé¦ˆ                        â”‚
â”‚     ğŸŒ¡ï¸ æ¸©åº¦æ˜¾ç¤ºï¼š24Â°C â†’ 25Â°C            â”‚
â”‚     ğŸ“Š æ¸©åº¦æ»‘å—æ›´æ–°                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     3. è§†è§‰åŠ¨ç”»åé¦ˆ                      â”‚
â”‚     âœ¨ æ¸©åº¦æ•°å­—åŠ¨ç”»ï¼ˆæ•°å­—è·³åŠ¨ï¼‰           â”‚
â”‚     ğŸ’« æ¸©åº¦å›¾æ ‡é—ªçƒ                      â”‚
â”‚     ğŸ¯ åé¦ˆæç¤ºæ¡†æ˜¾ç¤º                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åé¦ˆæµç¨‹è®¾è®¡

### å®Œæ•´åé¦ˆæµç¨‹

```
ç”¨æˆ·è¯­éŸ³ï¼š"æ¸©åº¦è°ƒé«˜"
    â†“
è¯­éŸ³è¯†åˆ«ï¼š"æ¸©åº¦è°ƒé«˜"
    â†“
æ„å›¾è¯†åˆ«ï¼šVehicleCommand(AC_TEMP_UP)
    â†“
æ‰§è¡Œå‘½ä»¤ï¼šVehicleControlExecutor.execute()
    â†“
çŠ¶æ€æ›´æ–°ï¼šRepository.updateACState()
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       å¹¶è¡Œåé¦ˆï¼ˆä¸‰ä¸ªå±‚æ¬¡ï¼‰             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. TTSåé¦ˆ                           â”‚
â”‚    - ç”Ÿæˆåé¦ˆæ–‡æœ¬ï¼š"æ¸©åº¦å·²è°ƒé«˜è‡³25åº¦"  â”‚
â”‚    - TTSManager.speak()              â”‚
â”‚    - è¯­éŸ³æ’­æŠ¥                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. UIçŠ¶æ€åé¦ˆ                        â”‚
â”‚    - StateFlowå‘å‡ºæ–°å€¼               â”‚
â”‚    - ViewModel.acStateæ›´æ–°           â”‚
â”‚    - UIç»„ä»¶è‡ªåŠ¨åˆ·æ–°                  â”‚
â”‚    - æ¸©åº¦æ˜¾ç¤ºæ›´æ–°ï¼š24Â°C â†’ 25Â°C       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. è§†è§‰åŠ¨ç”»åé¦ˆ                      â”‚
â”‚    - æ¸©åº¦æ•°å­—åŠ¨ç”»ï¼ˆæ•°å­—æ»šåŠ¨ï¼‰         â”‚
â”‚    - åé¦ˆæç¤ºæ¡†æ˜¾ç¤ºï¼ˆToast/Snackbarï¼‰â”‚
â”‚    - å›¾æ ‡åŠ¨ç”»ï¼ˆé—ªçƒï¼‰                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ç”¨æˆ·çœ‹åˆ°å’Œå¬åˆ°åé¦ˆ
```

---

## TTSè¯­éŸ³åé¦ˆ

### 1. TTSåé¦ˆæµç¨‹

```kotlin
/**
 * å®Œæ•´çš„å‘½ä»¤æ‰§è¡Œä¸åé¦ˆæµç¨‹
 */
class VoiceCommandHandler(
    private val executor: VehicleControlExecutor,
    private val ttsManager: TTSManager
) {
    
    suspend fun handleCommand(command: VehicleCommand) {
        // 1. æ‰§è¡Œå‘½ä»¤
        val result = executor.execute(command)
        
        // 2. æ ¹æ®ç»“æœç”ŸæˆTTSåé¦ˆ
        val feedbackText = when (result) {
            is CommandResult.Success -> result.message
            is CommandResult.Error -> result.message
        }
        
        // 3. TTSæ’­æŠ¥åé¦ˆ
        ttsManager.speak(feedbackText)
    }
}
```

### 2. åé¦ˆæ–‡æœ¬ç”Ÿæˆ

```kotlin
/**
 * è½¦è¾†æ§åˆ¶æ‰§è¡Œå™¨ - å¸¦è¯¦ç»†åé¦ˆ
 */
class VehicleControlExecutor(
    private val stateRepository: VehicleStateRepository
) {
    
    /**
     * æ¸©åº¦è°ƒé«˜ - å¸¦å®Œæ•´åé¦ˆ
     */
    private fun executeACTempUp(): CommandResult {
        val currentState = stateRepository.getCurrentState()
        val currentAC = currentState.ac
        
        // æ£€æŸ¥ç©ºè°ƒæ˜¯å¦æ‰“å¼€
        if (!currentAC.isOn) {
            return CommandResult.Success(
                message = "è¯·å…ˆæ‰“å¼€ç©ºè°ƒ",
                feedbackType = FeedbackType.WARNING
            )
        }
        
        // è®¡ç®—æ–°æ¸©åº¦
        val newTemp = (currentAC.temperature + 1).coerceIn(16, 32)
        
        // æ£€æŸ¥æ˜¯å¦å·²è¾¾åˆ°æœ€å¤§å€¼
        if (newTemp == currentAC.temperature && newTemp == 32) {
            return CommandResult.Success(
                message = "æ¸©åº¦å·²ç»æ˜¯æœ€é«˜äº†ï¼Œ32åº¦",
                feedbackType = FeedbackType.INFO
            )
        }
        
        // æ›´æ–°çŠ¶æ€
        val newAC = currentAC.copy(temperature = newTemp)
        stateRepository.updateACState(newAC)
        
        // ç”Ÿæˆè¯¦ç»†åé¦ˆ
        val feedbackMessage = buildFeedbackMessage(
            action = "æ¸©åº¦å·²è°ƒé«˜",
            newValue = newTemp,
            unit = "åº¦"
        )
        
        return CommandResult.Success(
            message = feedbackMessage,
            feedbackType = FeedbackType.SUCCESS,
            data = mapOf("temperature" to newTemp.toString())
        )
    }
    
    /**
     * æ„å»ºåé¦ˆæ¶ˆæ¯
     */
    private fun buildFeedbackMessage(
        action: String,
        newValue: Int,
        unit: String
    ): String {
        return "$actionè‡³${newValue}${unit}"
    }
}
```

### 3. TTSæ’­æŠ¥å®ç°

```kotlin
/**
 * TTSç®¡ç†å™¨
 */
class BaiduTTSManager(
    private val context: Context,
    private val appId: String,
    private val apiKey: String,
    private val secretKey: String
) {
    private var synthesizer: SpeechSynthesizer? = null
    private var isInitialized = false
    
    fun init() {
        if (isInitialized) return
        
        synthesizer = SpeechSynthesizer.getInstance()
        synthesizer?.setParam(SpeechSynthesizer.PARAM_APP_ID, appId)
        synthesizer?.setParam(SpeechSynthesizer.PARAM_API_KEY, apiKey)
        synthesizer?.setParam(SpeechSynthesizer.PARAM_SECRET_KEY, secretKey)
        
        // è®¾ç½®å‘éŸ³äººï¼ˆç”·å£°/å¥³å£°ï¼‰
        synthesizer?.setParam(SpeechSynthesizer.PARAM_SPEAKER, "1") // 1-ç”·å£°ï¼Œ0-å¥³å£°
        
        // è®¾ç½®è¯­é€Ÿï¼ˆ0-15ï¼Œé»˜è®¤5ï¼‰
        synthesizer?.setParam(SpeechSynthesizer.PARAM_SPEED, "5")
        
        // è®¾ç½®éŸ³è°ƒï¼ˆ0-15ï¼Œé»˜è®¤5ï¼‰
        synthesizer?.setParam(SpeechSynthesizer.PARAM_PITCH, "5")
        
        // è®¾ç½®éŸ³é‡ï¼ˆ0-15ï¼Œé»˜è®¤5ï¼‰
        synthesizer?.setParam(SpeechSynthesizer.PARAM_VOLUME, "5")
        
        synthesizer?.initTts(TtsMode.ONLINE)
        isInitialized = true
    }
    
    /**
     * æ’­æŠ¥æ–‡æœ¬
     */
    fun speak(text: String) {
        if (!isInitialized) {
            init()
        }
        
        synthesizer?.speak(text, object : SynthesizerListener {
            override fun onSynthesizeStart(utteranceId: String?) {
                // åˆæˆå¼€å§‹
                Log.d("TTS", "å¼€å§‹åˆæˆï¼š$text")
            }
            
            override fun onSpeechStart(utteranceId: String?) {
                // æ’­æ”¾å¼€å§‹
                Log.d("TTS", "å¼€å§‹æ’­æŠ¥ï¼š$text")
                // å¯ä»¥åœ¨è¿™é‡Œæ˜¾ç¤ºæ’­æ”¾çŠ¶æ€UI
            }
            
            override fun onSpeechProgressChanged(utteranceId: String?, progress: Int) {
                // æ’­æ”¾è¿›åº¦
            }
            
            override fun onSpeechFinish(utteranceId: String?) {
                // æ’­æ”¾å®Œæˆ
                Log.d("TTS", "æ’­æŠ¥å®Œæˆï¼š$text")
            }
            
            override fun onError(utteranceId: String?, speechError: SpeechError?) {
                // é”™è¯¯å¤„ç†
                Log.e("TTS", "æ’­æŠ¥é”™è¯¯ï¼š${speechError?.errorDescription}")
            }
            
            override fun onSynthesizeDataArrived(
                utteranceId: String?,
                data: ByteArray?,
                progress: Int
            ) {
                // åˆæˆæ•°æ®åˆ°è¾¾
            }
            
            override fun onSynthesizeFinish(utteranceId: String?) {
                // åˆæˆå®Œæˆ
            }
        })
    }
    
    /**
     * åœæ­¢æ’­æŠ¥
     */
    fun stop() {
        synthesizer?.stop()
    }
    
    /**
     * æš‚åœæ’­æŠ¥
     */
    fun pause() {
        synthesizer?.pause()
    }
    
    /**
     * æ¢å¤æ’­æŠ¥
     */
    fun resume() {
        synthesizer?.resume()
    }
}
```

### 4. åé¦ˆæ–‡æœ¬æ¨¡æ¿

```kotlin
/**
 * åé¦ˆæ¶ˆæ¯ç”Ÿæˆå™¨
 */
object FeedbackMessageGenerator {
    
    // ç©ºè°ƒåé¦ˆ
    fun acOn(temperature: Int): String = "ç©ºè°ƒå·²æ‰“å¼€ï¼Œå½“å‰æ¸©åº¦${temperature}åº¦"
    fun acOff(): String = "ç©ºè°ƒå·²å…³é—­"
    fun acTempUp(newTemp: Int): String = "æ¸©åº¦å·²è°ƒé«˜è‡³${newTemp}åº¦"
    fun acTempDown(newTemp: Int): String = "æ¸©åº¦å·²è°ƒä½è‡³${newTemp}åº¦"
    fun acTempSet(temp: Int): String = "æ¸©åº¦å·²è®¾ç½®ä¸º${temp}åº¦"
    fun acFanUp(newSpeed: Int): String = "é£é€Ÿå·²è°ƒé«˜è‡³${newSpeed}æ¡£"
    fun acFanDown(newSpeed: Int): String = "é£é€Ÿå·²è°ƒä½è‡³${newSpeed}æ¡£"
    fun acModeAuto(): String = "å·²åˆ‡æ¢åˆ°è‡ªåŠ¨æ¨¡å¼"
    fun acModeCool(): String = "å·²åˆ‡æ¢åˆ°åˆ¶å†·æ¨¡å¼"
    fun acModeHeat(): String = "å·²åˆ‡æ¢åˆ°åˆ¶çƒ­æ¨¡å¼"
    
    // åº§æ¤…åé¦ˆ
    fun seatForward(): String = "åº§æ¤…å·²å‰ç§»"
    fun seatBackward(): String = "åº§æ¤…å·²åç§»"
    fun seatHeatOn(): String = "åº§æ¤…åŠ çƒ­å·²æ‰“å¼€"
    fun seatHeatOff(): String = "åº§æ¤…åŠ çƒ­å·²å…³é—­"
    fun seatVentilationOn(): String = "åº§æ¤…é€šé£å·²æ‰“å¼€"
    fun seatVentilationOff(): String = "åº§æ¤…é€šé£å·²å…³é—­"
    fun seatReset(): String = "åº§æ¤…å·²å¤ä½"
    
    // è½¦çª—åé¦ˆ
    fun windowFrontOpen(): String = "å‰çª—å·²æ‰“å¼€"
    fun windowFrontClose(): String = "å‰çª—å·²å…³é—­"
    fun windowFrontHalf(): String = "å‰çª—å·²æ‰“å¼€ä¸€åŠ"
    fun windowRearOpen(): String = "åçª—å·²æ‰“å¼€"
    fun windowRearClose(): String = "åçª—å·²å…³é—­"
    fun sunroofOpen(): String = "å¤©çª—å·²æ‰“å¼€"
    fun sunroofClose(): String = "å¤©çª—å·²å…³é—­"
    
    // ç¯å…‰åé¦ˆ
    fun headlightOn(): String = "å¤§ç¯å·²æ‰“å¼€"
    fun headlightOff(): String = "å¤§ç¯å·²å…³é—­"
    fun headlightAuto(): String = "å·²åˆ‡æ¢åˆ°è‡ªåŠ¨å¤§ç¯"
    fun ambientLightOn(): String = "æ°›å›´ç¯å·²æ‰“å¼€"
    fun ambientLightOff(): String = "æ°›å›´ç¯å·²å…³é—­"
    fun ambientLightColor(color: String): String = "æ°›å›´ç¯å·²è°ƒæˆ${color}è‰²"
    
    // è½¦é—¨åé¦ˆ
    fun doorLock(): String = "è½¦è¾†å·²é”å®š"
    fun doorUnlock(): String = "è½¦è¾†å·²è§£é”"
    fun trunkOpen(): String = "åå¤‡ç®±å·²æ‰“å¼€"
    fun trunkClose(): String = "åå¤‡ç®±å·²å…³é—­"
    
    // å¼•æ“åé¦ˆ
    fun engineStart(): String = "è½¦è¾†å·²å¯åŠ¨"
    fun engineStop(): String = "è½¦è¾†å·²ç†„ç«"
    
    // é”™è¯¯åé¦ˆ
    fun errorACNotOn(): String = "è¯·å…ˆæ‰“å¼€ç©ºè°ƒ"
    fun errorTempRange(): String = "æ¸©åº¦åªèƒ½åœ¨16åˆ°32åº¦ä¹‹é—´"
    fun errorAlreadyMax(): String = "å·²ç»æ˜¯æœ€å¤§å€¼äº†"
    fun errorAlreadyMin(): String = "å·²ç»æ˜¯æœ€å°å€¼äº†"
    fun errorUnknown(): String = "æŠ±æ­‰ï¼Œæˆ‘æ²¡å¬æ¸…æ¥š"
}
```

---

## UIçŠ¶æ€åé¦ˆ

### 1. UIè‡ªåŠ¨æ›´æ–°æµç¨‹

```kotlin
/**
 * ViewModel - å¤„ç†å‘½ä»¤æ‰§è¡Œå’Œåé¦ˆ
 */
class VehicleControlViewModel(
    private val stateRepository: VehicleStateRepository,
    private val executor: VehicleControlExecutor,
    private val ttsManager: TTSManager
) : ViewModel() {
    
    // æš´éœ²çŠ¶æ€ç»™UI
    val acState: StateFlow<ACState> = stateRepository.vehicleState
        .map { it.ac }
        .stateIn(
            scope = viewModelScope,
            started = SharingStarted.WhileSubscribed(5000),
            initialValue = ACState()
        )
    
    // å‘½ä»¤æ‰§è¡Œç»“æœ
    private val _commandResult = MutableStateFlow<CommandResult?>(null)
    val commandResult: StateFlow<CommandResult?> = _commandResult.asStateFlow()
    
    /**
     * æ‰§è¡Œå‘½ä»¤ï¼ˆå¸¦å®Œæ•´åé¦ˆï¼‰
     */
    fun executeCommand(command: VehicleCommand) {
        viewModelScope.launch {
            // 1. æ‰§è¡Œå‘½ä»¤
            val result = executor.execute(command)
            
            // 2. ä¿å­˜ç»“æœï¼ˆç”¨äºUIæ˜¾ç¤ºï¼‰
            _commandResult.value = result
            
            // 3. TTSæ’­æŠ¥åé¦ˆ
            when (result) {
                is CommandResult.Success -> {
                    ttsManager.speak(result.message)
                }
                is CommandResult.Error -> {
                    ttsManager.speak(result.message)
                }
            }
            
            // 4. 3ç§’åæ¸…é™¤ç»“æœï¼ˆå¯é€‰ï¼‰
            delay(3000)
            _commandResult.value = null
        }
    }
}
```

### 2. Compose UI - å®Œæ•´åé¦ˆç¤ºä¾‹

```kotlin
@Composable
fun ACControlCard(
    viewModel: VehicleControlViewModel
) {
    // è§‚å¯Ÿç©ºè°ƒçŠ¶æ€
    val acState by viewModel.acState.collectAsState()
    
    // è§‚å¯Ÿå‘½ä»¤æ‰§è¡Œç»“æœ
    val commandResult by viewModel.commandResult.collectAsState()
    
    Card(
        modifier = Modifier.fillMaxWidth()
    ) {
        Column(
            modifier = Modifier.padding(16.dp),
            verticalArrangement = Arrangement.spacedBy(12.dp)
        ) {
            // æ ‡é¢˜
            Text(
                text = "ç©ºè°ƒ",
                style = MaterialTheme.typography.titleLarge,
                fontWeight = FontWeight.Bold
            )
            
            // å¼€å…³çŠ¶æ€
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.SpaceBetween,
                verticalAlignment = Alignment.CenterVertically
            ) {
                Text(text = "çŠ¶æ€")
                
                Switch(
                    checked = acState.isOn,
                    onCheckedChange = { checked ->
                        val command = if (checked) {
                            VehicleCommand(VehicleCommandType.AC_ON)
                        } else {
                            VehicleCommand(VehicleCommandType.AC_OFF)
                        }
                        viewModel.executeCommand(command)
                    }
                )
            }
            
            // æ¸©åº¦æ˜¾ç¤ºï¼ˆå¸¦åŠ¨ç”»ï¼‰
            if (acState.isOn) {
                TemperatureDisplay(
                    temperature = acState.temperature,
                    onIncrease = {
                        viewModel.executeCommand(
                            VehicleCommand(VehicleCommandType.AC_TEMP_UP)
                        )
                    },
                    onDecrease = {
                        viewModel.executeCommand(
                            VehicleCommand(VehicleCommandType.AC_TEMP_DOWN)
                        )
                    }
                )
            }
            
            // åé¦ˆæç¤ºï¼ˆæ˜¾ç¤ºå‘½ä»¤æ‰§è¡Œç»“æœï¼‰
            commandResult?.let { result ->
                FeedbackBanner(
                    result = result,
                    modifier = Modifier.fillMaxWidth()
                )
            }
        }
    }
}

/**
 * æ¸©åº¦æ˜¾ç¤ºç»„ä»¶ï¼ˆå¸¦åŠ¨ç”»ï¼‰
 */
@Composable
fun TemperatureDisplay(
    temperature: Int,
    onIncrease: () -> Unit,
    onDecrease: () -> Unit
) {
    // åŠ¨ç”»å€¼
    val animatedTemperature by animateIntAsState(
        targetValue = temperature,
        animationSpec = tween(
            durationMillis = 500,
            easing = FastOutSlowInEasing
        ),
        label = "temperature"
    )
    
    Row(
        modifier = Modifier.fillMaxWidth(),
        horizontalArrangement = Arrangement.SpaceBetween,
        verticalAlignment = Alignment.CenterVertically
    ) {
        Text(text = "æ¸©åº¦")
        
        Row(
            horizontalArrangement = Arrangement.spacedBy(8.dp),
            verticalAlignment = Alignment.CenterVertically
        ) {
            IconButton(onClick = onDecrease) {
                Icon(Icons.Default.Remove, contentDescription = "é™ä½")
            }
            
            // æ¸©åº¦æ•°å­—ï¼ˆå¸¦åŠ¨ç”»æ•ˆæœï¼‰
            Text(
                text = "${animatedTemperature}Â°C",
                style = MaterialTheme.typography.headlineMedium,
                fontWeight = FontWeight.Bold,
                color = MaterialTheme.colorScheme.primary
            )
            
            IconButton(onClick = onIncrease) {
                Icon(Icons.Default.Add, contentDescription = "å‡é«˜")
            }
        }
    }
}

/**
 * åé¦ˆæç¤ºæ¨ªå¹…
 */
@Composable
fun FeedbackBanner(
    result: CommandResult,
    modifier: Modifier = Modifier
) {
    val (message, color, icon) = when (result) {
        is CommandResult.Success -> {
            Triple(
                result.message,
                MaterialTheme.colorScheme.primary,
                Icons.Default.CheckCircle
            )
        }
        is CommandResult.Error -> {
            Triple(
                result.message,
                MaterialTheme.colorScheme.error,
                Icons.Default.Error
            )
        }
    }
    
    // æ·¡å…¥æ·¡å‡ºåŠ¨ç”»
    val alpha by animateFloatAsState(
        targetValue = if (result != null) 1f else 0f,
        animationSpec = tween(300),
        label = "feedback_alpha"
    )
    
    if (alpha > 0f) {
        Surface(
            modifier = modifier
                .alpha(alpha)
                .fillMaxWidth(),
            color = color.copy(alpha = 0.1f),
            shape = RoundedCornerShape(8.dp)
        ) {
            Row(
                modifier = Modifier
                    .fillMaxWidth()
                    .padding(12.dp),
                horizontalArrangement = Arrangement.spacedBy(8.dp),
                verticalAlignment = Alignment.CenterVertically
            ) {
                Icon(
                    imageVector = icon,
                    contentDescription = null,
                    tint = color
                )
                Text(
                    text = message,
                    color = color,
                    style = MaterialTheme.typography.bodyMedium
                )
            }
        }
    }
}
```

### 3. ä¼ ç»ŸView UI - å®Œæ•´åé¦ˆç¤ºä¾‹

```kotlin
class VehicleControlPanelFragment : Fragment() {
    
    private lateinit var viewModel: VehicleControlViewModel
    private lateinit var binding: FragmentVehicleControlBinding
    
    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)
        
        viewModel = ViewModelProvider(this)[VehicleControlViewModel::class.java]
        
        // è§‚å¯Ÿç©ºè°ƒçŠ¶æ€
        viewLifecycleOwner.lifecycleScope.launch {
            viewModel.acState.collect { acState ->
                updateACUI(acState)
            }
        }
        
        // è§‚å¯Ÿå‘½ä»¤æ‰§è¡Œç»“æœ
        viewLifecycleOwner.lifecycleScope.launch {
            viewModel.commandResult.collect { result ->
                showFeedback(result)
            }
        }
        
        // è®¾ç½®ç‚¹å‡»äº‹ä»¶
        setupClickListeners()
    }
    
    /**
     * æ›´æ–°ç©ºè°ƒUI
     */
    private fun updateACUI(acState: ACState) {
        // æ›´æ–°æ¸©åº¦æ˜¾ç¤ºï¼ˆå¸¦åŠ¨ç”»ï¼‰
        animateTemperatureChange(
            from = binding.temperatureText.tag as? Int ?: acState.temperature,
            to = acState.temperature
        )
        binding.temperatureText.tag = acState.temperature
        
        // æ›´æ–°å…¶ä»–UI...
    }
    
    /**
     * æ¸©åº¦æ•°å­—åŠ¨ç”»
     */
    private fun animateTemperatureChange(from: Int, to: Int) {
        val animator = ValueAnimator.ofInt(from, to)
        animator.duration = 500
        animator.interpolator = AccelerateDecelerateInterpolator()
        
        animator.addUpdateListener { animation ->
            val value = animation.animatedValue as Int
            binding.temperatureText.text = "${value}Â°C"
        }
        
        animator.start()
    }
    
    /**
     * æ˜¾ç¤ºåé¦ˆ
     */
    private fun showFeedback(result: CommandResult?) {
        result?.let {
            val message = when (it) {
                is CommandResult.Success -> it.message
                is CommandResult.Error -> it.message
            }
            
            // æ–¹å¼1ï¼šToastæç¤º
            Toast.makeText(context, message, Toast.LENGTH_SHORT).show()
            
            // æ–¹å¼2ï¼šSnackbaræç¤ºï¼ˆæ›´ç°ä»£ï¼‰
            // Snackbar.make(binding.root, message, Snackbar.LENGTH_SHORT).show()
            
            // æ–¹å¼3ï¼šè‡ªå®šä¹‰åé¦ˆè§†å›¾
            // showCustomFeedbackView(message)
        }
    }
    
    /**
     * è®¾ç½®ç‚¹å‡»äº‹ä»¶
     */
    private fun setupClickListeners() {
        binding.temperatureUpBtn.setOnClickListener {
            viewModel.executeCommand(
                VehicleCommand(VehicleCommandType.AC_TEMP_UP)
            )
        }
        
        binding.temperatureDownBtn.setOnClickListener {
            viewModel.executeCommand(
                VehicleCommand(VehicleCommandType.AC_TEMP_DOWN)
            )
        }
    }
}
```

---

## è§†è§‰åŠ¨ç”»åé¦ˆ

### 1. æ¸©åº¦æ•°å­—æ»šåŠ¨åŠ¨ç”»

```kotlin
/**
 * æ¸©åº¦æ•°å­—åŠ¨ç”»ç»„ä»¶ï¼ˆComposeï¼‰
 */
@Composable
fun AnimatedTemperature(
    temperature: Int,
    modifier: Modifier = Modifier
) {
    val animatedValue by animateIntAsState(
        targetValue = temperature,
        animationSpec = spring(
            dampingRatio = Spring.DampingRatioMediumBouncy,
            stiffness = Spring.StiffnessLow
        ),
        label = "temperature_animation"
    )
    
    Text(
        text = "${animatedValue}Â°C",
        style = MaterialTheme.typography.headlineLarge,
        fontWeight = FontWeight.Bold,
        modifier = modifier
    )
}
```

### 2. å›¾æ ‡é—ªçƒåŠ¨ç”»

```kotlin
/**
 * å›¾æ ‡é—ªçƒåŠ¨ç”»ï¼ˆè¡¨ç¤ºçŠ¶æ€å˜åŒ–ï¼‰
 */
@Composable
fun BlinkingIcon(
    icon: ImageVector,
    modifier: Modifier = Modifier,
    durationMillis: Int = 1000
) {
    val infiniteTransition = rememberInfiniteTransition(label = "blink")
    
    val alpha by infiniteTransition.animateFloat(
        initialValue = 1f,
        targetValue = 0.3f,
        animationSpec = infiniteRepeatable(
            animation = tween(durationMillis, easing = LinearEasing),
            repeatMode = RepeatMode.Reverse
        ),
        label = "alpha"
    )
    
    Icon(
        imageVector = icon,
        contentDescription = null,
        modifier = modifier.alpha(alpha),
        tint = MaterialTheme.colorScheme.primary
    )
}
```

### 3. æˆåŠŸåé¦ˆåŠ¨ç”»

```kotlin
/**
 * æˆåŠŸåé¦ˆåŠ¨ç”»ï¼ˆå‹¾é€‰æ ‡è®°ï¼‰
 */
@Composable
fun SuccessFeedback(
    modifier: Modifier = Modifier
) {
    val scale by animateFloatAsState(
        targetValue = 1f,
        animationSpec = spring(
            dampingRatio = Spring.DampingRatioMediumBouncy,
            stiffness = Spring.StiffnessLow
        ),
        label = "scale"
    )
    
    Icon(
        imageVector = Icons.Default.CheckCircle,
        contentDescription = null,
        modifier = modifier.scale(scale),
        tint = MaterialTheme.colorScheme.primary,
        fontSize = 48.sp
    )
}
```

---

## å®Œæ•´ç¤ºä¾‹ï¼šè°ƒèŠ‚ç©ºè°ƒ

### åœºæ™¯ï¼šç”¨æˆ·è¯´"æ¸©åº¦è°ƒé«˜"

#### 1. æ‰§è¡Œæµç¨‹

```kotlin
// ç”¨æˆ·è¯­éŸ³ï¼š"æ¸©åº¦è°ƒé«˜"
// â†“
// è¯­éŸ³è¯†åˆ«ï¼š"æ¸©åº¦è°ƒé«˜"
// â†“
// æ„å›¾è¯†åˆ«ï¼šVehicleCommand(AC_TEMP_UP)
// â†“
// æ‰§è¡Œå‘½ä»¤
viewModel.executeCommand(VehicleCommand(AC_TEMP_UP))
```

#### 2. ä»£ç æ‰§è¡Œ

```kotlin
/**
 * ViewModelæ‰§è¡Œå‘½ä»¤
 */
fun executeCommand(command: VehicleCommand) {
    viewModelScope.launch {
        // 1. æ‰§è¡Œå‘½ä»¤
        val result = executor.execute(command)
        // result = CommandResult.Success("æ¸©åº¦å·²è°ƒé«˜è‡³25åº¦")
        
        // 2. çŠ¶æ€å·²æ›´æ–°ï¼ˆåœ¨executorä¸­ï¼‰
        // Repository.vehicleState.value.ac.temperature = 25
        
        // 3. TTSæ’­æŠ¥
        ttsManager.speak("æ¸©åº¦å·²è°ƒé«˜è‡³25åº¦")
        // ğŸ”Š ç”¨æˆ·å¬åˆ°ï¼š"æ¸©åº¦å·²è°ƒé«˜è‡³25åº¦"
    }
}
```

#### 3. UIè‡ªåŠ¨æ›´æ–°

```kotlin
// UIç»„ä»¶è§‚å¯ŸçŠ¶æ€å˜åŒ–
val acState by viewModel.acState.collectAsState()

// acState.temperature ä» 24 å˜ä¸º 25
// â†“
// è‡ªåŠ¨è§¦å‘UIé‡ç»„/æ›´æ–°
// â†“
// æ¸©åº¦æ˜¾ç¤ºï¼š24Â°C â†’ 25Â°Cï¼ˆå¸¦åŠ¨ç”»ï¼‰
```

#### 4. å®Œæ•´åé¦ˆå±•ç¤º

```
ç”¨æˆ·çœ‹åˆ°å’Œå¬åˆ°ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”Š è¯­éŸ³ï¼š"æ¸©åº¦å·²è°ƒé«˜è‡³25åº¦"      â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸŒ¡ï¸ æ¸©åº¦                  â”‚ â”‚
â”‚  â”‚                           â”‚ â”‚
â”‚  â”‚  24Â°C â†’ 25Â°C  (æ•°å­—æ»šåŠ¨)  â”‚ â”‚
â”‚  â”‚                           â”‚ â”‚
â”‚  â”‚  âœ… æ¸©åº¦å·²è°ƒé«˜è‡³25åº¦       â”‚ â”‚
â”‚  â”‚     (æç¤ºæ¡†æ·¡å…¥æ·¡å‡º)        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åé¦ˆæœºåˆ¶æ€»ç»“

### åé¦ˆçš„ä¸‰ä¸ªå±‚æ¬¡

| åé¦ˆç±»å‹ | å®ç°æ–¹å¼ | ç”¨æˆ·æ„ŸçŸ¥ | æ—¶æœº |
|---------|---------|---------|------|
| **TTSè¯­éŸ³åé¦ˆ** | ç™¾åº¦TTSæ’­æŠ¥ | ğŸ”Š å¬åˆ° | å‘½ä»¤æ‰§è¡Œåç«‹å³ |
| **UIçŠ¶æ€åé¦ˆ** | StateFlowè‡ªåŠ¨æ›´æ–°UI | ğŸ‘€ çœ‹åˆ°æ•°æ®å˜åŒ– | çŠ¶æ€æ›´æ–°åç«‹å³ |
| **è§†è§‰åŠ¨ç”»åé¦ˆ** | æ•°å­—åŠ¨ç”»/å›¾æ ‡é—ªçƒ | âœ¨ çœ‹åˆ°åŠ¨ç”»æ•ˆæœ | çŠ¶æ€æ›´æ–°æ—¶åŒæ­¥ |

### åé¦ˆæ—¶æœº

```
å‘½ä»¤æ‰§è¡Œ
    â†“
çŠ¶æ€æ›´æ–°ï¼ˆRepositoryï¼‰
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¹¶è¡Œåé¦ˆ           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TTSæ’­æŠ¥ï¼ˆå¼‚æ­¥ï¼‰      â”‚ â† å¯èƒ½éœ€è¦1-2ç§’
â”‚ UIæ›´æ–°ï¼ˆåŒæ­¥ï¼‰       â”‚ â† ç«‹å³
â”‚ åŠ¨ç”»æ•ˆæœï¼ˆåŒæ­¥ï¼‰     â”‚ â† ç«‹å³
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœ€ä½³å®è·µ

1. **å³æ—¶åé¦ˆ**ï¼šUIçŠ¶æ€ç«‹å³æ›´æ–°ï¼Œè®©ç”¨æˆ·çŸ¥é“æ“ä½œå·²å“åº”
2. **è¯­éŸ³åé¦ˆ**ï¼šæä¾›æ˜ç¡®çš„è¯­éŸ³ç¡®è®¤ï¼Œç‰¹åˆ«æ˜¯åœ¨è½¦è½½åœºæ™¯
3. **è§†è§‰åé¦ˆ**ï¼šä½¿ç”¨åŠ¨ç”»å¢å¼ºç”¨æˆ·ä½“éªŒï¼Œä½†ä¸è¦è¿‡åº¦
4. **é”™è¯¯å¤„ç†**ï¼šå¤±è´¥æ—¶ä¹Ÿè¦æœ‰æ˜ç¡®çš„åé¦ˆï¼Œä¸è¦é™é»˜å¤±è´¥

---

è¿™æ ·çš„åé¦ˆæœºåˆ¶èƒ½å¤Ÿï¼š
- âœ… è®©ç”¨æˆ·æ˜ç¡®çŸ¥é“æ“ä½œå·²æ‰§è¡Œ
- âœ… æä¾›å¤šå±‚æ¬¡çš„åé¦ˆï¼ˆå¬è§‰+è§†è§‰ï¼‰
- âœ… å¢å¼ºç”¨æˆ·ä½“éªŒå’Œä¿¡ä»»æ„Ÿ
- âœ… é€‚åˆè½¦è½½åœºæ™¯ï¼ˆå‡å°‘è§†è§‰æ³¨æ„åŠ›éœ€æ±‚ï¼‰

